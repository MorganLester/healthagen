/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.2 - 2014-04-02
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(n,e,r){n.prev=function(){n.index--},n.next=function(){n.index++}},template:'<div class="rn-carousel-controls"><span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span><span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span></div>'}}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span></div>'}}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(n,e,r,a,o,t){var i=0,u=75,s=.05,c=3,l=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(d,f){var x=d.children()[0].attributes,p=!1,m=!1,v=0,g=!1,I,h;return d.addClass("rn-carousel-slides"),d.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(n){var e=x[n];if(angular.isDefined(e)){var r=e.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),a=r[3];if(I=r[1],h=r[2],I)return angular.isDefined(f.rnCarouselBuffered)&&(m=!0,e.value=I+" in "+h+"|carouselSlice:carouselBufferIndex:carouselBufferSize",a&&(e.value+=" track by "+a)),p=!0,!1}return!0}),function(d,f,x,v){function I(){for(var n=[],e=0;X>e;e++)n[e]=e;d.carouselIndicatorArray=n}function $(){var n=H.children();return F=0===n.length?H[0].getBoundingClientRect().width:n[0].getBoundingClientRect().width}function b(){J.css("width","100%");var n=$();n&&J.css("width",n+"px")}function y(n){isNaN(n)&&(n=d.carouselIndex*F),P=n;var e=-Math.round(P);e+=d.carouselBufferIndex*F,H[0].style[R]=W?"translate3d("+e+"px, 0, 0)":"translate("+e+"px, 0)"}function w(){var n,e;E&&(n=Date.now()-G,e=E*Math.exp(-n/u),e>c||-c>e?(y(V-e),l(w)):S(V/F))}function C(n){return n>=X?X:0>=n?0:n}function B(){var n=0,e=(d.carouselBufferSize-1)/2;m&&(n=d.carouselIndex<=e?0:X<d.carouselBufferSize?0:d.carouselIndex>X-d.carouselBufferSize?X-d.carouselBufferSize:d.carouselIndex-e),d.carouselBufferIndex=n}function S(n,e){return isNaN(n)&&(n=d.carouselIndex),e?(P=n*F,void N(null,null,!0)):(d.carouselIndex=C(n),B(),"$apply"!==t.$$phase&&"$digest"!==t.$$phase&&(g?d.$apply():d.$digest()),void y())}function z(){return s*F}function k(n){Y=!0,N({x:n.clientX,y:n.clientY},n)}function A(n){var e=n;return 0===d.carouselIndex?e=Math.max(-z(),e):d.carouselIndex===X-1&&(e=Math.min((X-1)*F+z(),e)),e}function D(n,e){return r.bind("mouseup",k),j=!0,q=n.x,E=0,G=Date.now(),!1}function M(n,e){var r,a;return j&&(r=n.x,a=q-r,(a>2||-2>a)&&(Y=!0,q=r,l(function(){y(A(P+a))}))),!1}function N(n,e,a){if(!e||Y){r.unbind("mouseup",k),j=!1,Y=!1,V=P;var o=z(),t=d.carouselIndex*F,i=t-V,u=-Math[i>=0?"ceil":"floor"](i/F),s=Math.abs(i)>o;u+d.carouselIndex>=X&&(u=X-1-d.carouselIndex),u+d.carouselIndex<0&&(u=-d.carouselIndex);var c=s?u:0;return V=(c+d.carouselIndex)*F,E=V-P,G=Date.now(),a&&(E=P-t),l(w),!1}}function T(){var n=document.createElement("p"),e,r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(n,null);for(var a in r)void 0!==n.style[a]&&(n.style[a]="translate3d(1px,1px,1px)",e=window.getComputedStyle(n).getPropertyValue(r[a]));return document.body.removeChild(n),void 0!==e&&e.length>0&&"none"!==e}function O(){b(),S()}i++;var F,R,j,q,E,P=0,V,X=0,Y=!1,G,H=f.wrap("<div id='carousel-"+i+"' class='rn-carousel-container'></div>"),J=H.parent();if((angular.isDefined(x.rnCarouselIndicator)||angular.isDefined(x.rnCarouselControl))&&(I(),d.$watch("carouselIndex",function(n){d.indicatorIndex=n}),d.$watch("indicatorIndex",function(n){S(n,!0)})),angular.isDefined(x.rnCarouselIndicator)){var K=o("<div id='carousel-"+i+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(d);J.append(K)}if(angular.isDefined(x.rnCarouselControl)){var L=o("<div id='carousel-"+i+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(d);J.append(L)}if(d.carouselBufferIndex=0,d.carouselBufferSize=5,d.carouselIndex=0,x.rnCarouselIndex){var Q=function(n){U.assign(d.$parent,n)},U=a(x.rnCarouselIndex);angular.isFunction(U.assign)?(d.$watch("carouselIndex",function(n){Q(n)}),d.carouselIndex=U(d),d.$parent.$watch(U,function(n,e){void 0!==n&&(n>=X?(n=X-1,Q(n)):0>n&&(n=0,Q(n)),S(n,!0))}),g=!0):isNaN(x.rnCarouselIndex)||(d.carouselIndex=parseInt(x.rnCarouselIndex,10))}p?d.$watchCollection(h,function(n,e){X=0,angular.isArray(n)?X=n.length:angular.isObject(n)&&(X=Object.keys(n).length),I(),F||b(),S(d.carouselIndex)}):(X=f.children().length,I(),b()),x.$observe("rnCarouselSwipe",function(e,r){"false"!==e&&"off"!==e?n.bind(H,{start:D,move:M,end:N,cancel:function(n){N({},n)}}):H.unbind()}),g||S(d.carouselIndex),R="transform",["webkit","Moz","O","ms"].every(function(n){var e=n+"Transform";return"undefined"!=typeof document.body.style[e]?(R=e,!1):!0});var W=T(),Z=angular.element(e);Z.bind("orientationchange",O),Z.bind("resize",O),d.$on("$destroy",function(){r.unbind("mouseup",k),Z.unbind("orientationchange",O),Z.unbind("resize",O)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(n,e,r){return angular.isArray(n)?n.slice(e,e+r):angular.isObject(n)?n:void 0}})}();