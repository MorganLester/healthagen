!function(){"use strict";function t(){var t={};return{on:function(e,n){return e.split(" ").forEach(function(e){t[e]||(t[e]=[]),t[e].push(n)}),this},trigger:function(e,n){return angular.forEach(t[e],function(t){t.call(null,n)}),this}}}function e(t,e){return t=t||[],t.length>0&&!angular.isObject(t[0])&&t.forEach(function(n,a){t[a]={},t[a][e]=n}),t}function n(t,e,n){for(var a=null,i=0;i<t.length;i++)if(t[i][n].toLowerCase()===e[n].toLowerCase()){a=t[i];break}return a}var a={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},i=angular.module("ngTagsInput",[]);i.directive("tagsInput",["$timeout","$document","tagsInputConfig",function(i,o,r){function s(t,e){var a={},i,o,r;return i=function(e){return e[t.displayProperty]},o=function(e,n){e[t.displayProperty]=n},r=function(e){var o=i(e);return o.length>=t.minLength&&o.length<=(t.maxLength||o.length)&&t.allowedTagsPattern.test(o)&&!n(a.items,e,t.displayProperty)},a.items=[],a.addText=function(t){var e={};return o(e,t),a.add(e)},a.add=function(n){var s=i(n).trim();return t.replaceSpacesWithDashes&&(s=s.replace(/\s/g,"-")),o(n,s),r(n)?(a.items.push(n),e.trigger("tag-added",{$tag:n})):e.trigger("invalid-tag",{$tag:n}),n},a.remove=function(t){var n=a.items.splice(t,1)[0];return e.trigger("tag-removed",{$tag:n}),n},a.removeLast=function(){var e,n=a.items.length-1;return t.enableEditingLastTag||a.selected?(a.selected=null,e=a.remove(n)):a.selected||(a.selected=a.items[n]),e},a}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(e,n,a){r.load("tagsInput",e,n,{placeholder:[String,""],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number],maxTags:[Number],displayProperty:[String,"text"],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1]}),e.events=new t,e.tagList=new s(e.options,e.events),this.registerAutocomplete=function(){var t=a.find("input");return t.on("keydown",function(t){e.events.trigger("input-keydown",t)}),{addTag:function(t){return e.tagList.add(t)},focusInput:function(){t[0].focus()},getTags:function(){return e.tags},getOptions:function(){return e.options},on:function(t,n){return e.events.on(t,n),this}}}}],link:function(t,n,r,s){var u=[a.enter,a.comma,a.space,a.backspace],l=t.tagList,c=t.events,g=t.options,d=n.find("input");c.on("tag-added",t.onTagAdded).on("tag-removed",t.onTagRemoved).on("tag-added",function(){t.newTag.text=""}).on("tag-added tag-removed",function(){s.$setViewValue(t.tags)}).on("invalid-tag",function(){t.newTag.invalid=!0}).on("input-change",function(){l.selected=null,t.newTag.invalid=null}).on("input-focus",function(){s.$setValidity("leftoverText",!0)}).on("input-blur",function(){g.addFromAutocompleteOnly||(g.addOnBlur&&l.addText(t.newTag.text),s.$setValidity("leftoverText",g.allowLeftoverText?!0:!t.newTag.text))}),t.newTag={text:"",invalid:null},t.getDisplayText=function(t){return t[g.displayProperty].trim()},t.track=function(t){return t[g.displayProperty]},t.newTagChange=function(){c.trigger("input-change",t.newTag.text)},t.$watch("tags",function(n){t.tags=e(n,g.displayProperty),l.items=t.tags}),t.$watch("tags.length",function(t){s.$setValidity("maxTags",angular.isUndefined(g.maxTags)||t<=g.maxTags),s.$setValidity("minTags",angular.isUndefined(g.minTags)||t>=g.minTags)}),d.on("keydown",function(e){if(!e.isImmediatePropagationStopped||!e.isImmediatePropagationStopped()){var n=e.keyCode,i=e.shiftKey||e.altKey||e.ctrlKey||e.metaKey,o={},r,s;if(!i&&-1!==u.indexOf(n))if(o[a.enter]=g.addOnEnter,o[a.comma]=g.addOnComma,o[a.space]=g.addOnSpace,r=!g.addFromAutocompleteOnly&&o[n],s=!r&&n===a.backspace&&0===t.newTag.text.length,r)l.addText(t.newTag.text),t.$apply(),e.preventDefault();else if(s){var c=l.removeLast();c&&g.enableEditingLastTag&&(t.newTag.text=c[g.displayProperty]),t.$apply(),e.preventDefault()}}}).on("focus",function(){t.hasFocus||(t.hasFocus=!0,c.trigger("input-focus"),t.$apply())}).on("blur",function(){i(function(){var e=o.prop("activeElement"),a=e===d[0],i=n[0].contains(e);(a||!i)&&(t.hasFocus=!1,c.trigger("input-blur"))})}),n.find("div").on("click",function(){d[0].focus()})}}}]),i.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function(t,i,o,r){function s(t,a){var o={},r,s,u;return s=function(t,e){return t.filter(function(t){return!n(e,t,a.tagsInput.displayProperty)})},o.reset=function(){u=null,o.items=[],o.visible=!1,o.index=-1,o.selected=null,o.query=null,i.cancel(r)},o.show=function(){o.selected=null,o.visible=!0},o.load=function(n,l){return n.length<a.minLength?void o.reset():(i.cancel(r),void(r=i(function(){o.query=n;var i=t({$query:n});u=i,i.then(function(t){i===u&&(t=e(t.data||t,a.tagsInput.displayProperty),o.items=s(t,l),o.items.length>0?o.show():o.reset())})},a.debounceDelay,!1)))},o.selectNext=function(){o.select(++o.index)},o.selectPrior=function(){o.select(--o.index)},o.select=function(t){0>t?t=o.items.length-1:t>=o.items.length&&(t=0),o.index=t,o.selected=o.items[t]},o.reset(),o}function u(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(e,n,i,l){var c=[a.enter,a.tab,a.escape,a.up,a.down],g,d,p,f,m;r.load("autoComplete",e,i,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10]}),p=e.options,d=l.registerAutocomplete(),p.tagsInput=d.getOptions(),g=new s(e.source,p),f=function(t){return t[p.tagsInput.displayProperty]},m=p.highlightMatchedText?function(t,e){var n=new RegExp(e,"gi");return t.replace(n,"**$&**")}:function(t){return t},e.suggestionList=g,e.addSuggestion=function(){var t=!1;return g.selected&&(d.addTag(g.selected),g.reset(),d.focusInput(),t=!0),t},e.highlight=function(t){var e=f(t);return e=m(e,g.query),e=u(e),e=e.replace(/\*\*(.+?)\*\*/g,"<em>$1</em>"),o.trustAsHtml(e)},e.track=function(t){return f(t)},d.on("tag-added invalid-tag",function(){g.reset()}).on("input-change",function(t){t?g.load(t,d.getTags()):g.reset()}).on("input-keydown",function(t){var n,i;if(-1!==c.indexOf(t.keyCode)){var o=!1;t.stopImmediatePropagation=function(){o=!0,t.stopPropagation()},t.isImmediatePropagationStopped=function(){return o},g.visible&&(n=t.keyCode,i=!1,n===a.down?(g.selectNext(),i=!0):n===a.up?(g.selectPrior(),i=!0):n===a.escape?(g.reset(),i=!0):(n===a.enter||n===a.tab)&&(i=e.addSuggestion()),i&&(t.preventDefault(),t.stopImmediatePropagation(),e.$apply()))}}).on("input-blur",function(){g.reset()}),t.on("click",function(){g.visible&&(g.reset(),e.$apply())})}}}]),i.directive("tiTranscludeAppend",function(){return function(t,e,n,a,i){i(function(t){e.append(t)})}}),i.directive("tiAutosize",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){var i=3,o,r;o=angular.element('<span class="input"></span>'),o.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),e.parent().append(o),r=function(t){var a=t,r;return angular.isString(a)&&0===a.length&&(a=n.placeholder),a&&(o.text(a),o.css("display",""),r=o.prop("offsetWidth"),o.css("display","none")),e.css("width",r?r+i+"px":""),t},a.$parsers.unshift(r),a.$formatters.unshift(r)}}}),i.provider("tagsInputConfig",function(){var t={},e={};this.setDefaults=function(e,n){return t[e]=n,this},this.setActiveInterpolation=function(t,n){return e[t]=n,this},this.$get=["$interpolate",function(n){var a={};return a[String]=function(t){return t},a[Number]=function(t){return parseInt(t,10)},a[Boolean]=function(t){return"true"===t.toLowerCase()},a[RegExp]=function(t){return new RegExp(t)},{load:function(i,o,r,s){o.options={},angular.forEach(s,function(s,u){var l,c,g,d,p;l=s[0],c=s[1],g=a[l],d=function(){var e=t[i]&&t[i][u];return angular.isDefined(e)?e:c},p=function(t){o.options[u]=t?g(t):d()},e[i]&&e[i][u]?r.$observe(u,function(t){p(t)}):p(r[u]&&n(r[u])(o.$parent))})}}}]}),i.run(["$templateCache",function(t){t.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }"><span>{{getDisplayText(tag)}}</span> <a class="remove-button" ng-click="tagList.remove($index)">{{options.removeTagSymbol}}</a></li></ul><input class="input" placeholder="{{options.placeholder}}" tabindex="{{options.tabindex}}" ng-model="newTag.text" ng-change="newTagChange()" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ti-autosize=""></div></div>'),t.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items | limitTo:options.maxResultsToShow track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li></ul></div>')}])}();